#!/usr/bin/env python
import json
import socket
import os.path
import optparse

parser = optparse.OptionParser()
parser.add_option(
    "-e", "--eval", dest="source",
    help="evaluate the Clojure FORM", metavar="FORM")
parser.add_option(
    "-c", "--classpath", dest="classpath",
    help="use the supplied CLASSPATH", metavar="CLASSPATH")

(opts, args) = parser.parse_args()

classpath = ["file://" + os.path.abspath(p) for p in opts.classpath.split(':')]

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect(('localhost', 8000))
sock.send(json.dumps({"classpath": classpath}))
sock.send(json.dumps({"source": opts.source}))
data = json.loads(sock.recv(1024))
sock.close()

print data['return']
